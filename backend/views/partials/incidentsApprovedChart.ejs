<div
  class="w-full md:w-5/12 lg:w-2/5 rounded-xl shadow-md p-6"
  style="background-color: #ffffff; border: 2px solid #e5edfa"
>
  <h3
    class="text-lg md:text-xl font-bold mb-8"
    style="color: #0c0c22"
  >
    Incidencias aprobadas
  </h3>
  <div id="incidentsChart" style="width: 100%; height: 350px"></div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
      const approvedIncidents = <%= typeof chartData !== 'undefined' && chartData.approvedIncidents !== undefined ? chartData.approvedIncidents : 5 %>;
      const notApprovedIncidents = <%= typeof chartData !== 'undefined' && chartData.notApprovedIncidents !== undefined ? chartData.notApprovedIncidents : 3 %>;

      const incidentsChartDOM = document.getElementById('incidentsChart');
      if (incidentsChartDOM && typeof echarts !== 'undefined') {
          const incidentsChart = echarts.init(incidentsChartDOM);
          const incidentsOption = {
            tooltip: { trigger: 'item', formatter: '{b}: {c} ({d}%)' },
            legend: {
              orient: 'horizontal',
              bottom: 0,
              left: 'center'
            },
            series: [{
              name: 'Incidencias',
              type: 'pie',
              radius: ['40%', '70%'],
              center: ['50%', '40%'],
              avoidLabelOverlap: false,
              label: {
                show: false,
                position: 'center'
              },
              emphasis: {
                label: {
                  show: false
                }
              },
              labelLine: {
                show: false
              },
              data: [
                { value: approvedIncidents, name: 'Aprobadas', itemStyle: { color: '#22c55e' } },
                { value: notApprovedIncidents, name: 'No aprobadas', itemStyle: { color: '#ff312e' } }
              ]
            }]
          };
          incidentsChart.setOption(incidentsOption);
          
          window.addEventListener('resize', function() {
            incidentsChart.resize();
          });
      }
  });
</script>
